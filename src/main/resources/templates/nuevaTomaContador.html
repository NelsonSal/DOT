<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">


<head th:replace="~{layout/layout :: head}">

    <meta charset="UTF-8">
    <title>DOT inicio</title>

</head>
<body>


<div class="container-fluid" layout:fragment="page-content">
    <div>

        <h3>NUEVA TOMA CONTADOR</h3>

        <!-- <a th:href="@{/agregarEvento}" class="btn btn-primary">Agregar Evento</a> -->
            <div >

                <TABLE class="table table-striped table-sm  table-hover border" >
                    <tr>
                        <th>CLIENTE  </th><td th:text="${ultimoEvento.equipo.cliente.nombre}"></td>
                        <th>EQUIPO MARCA</th><td th:text="${ultimoEvento.equipo.marca.name}"></td>
                        <th>MODELO</th><td th:text="${ultimoEvento.equipo.modelo.name}"></td>
                    </tr>
                    <tr>
                        <th>SERIE</th><td th:text="${ultimoEvento.equipo.serial}"></td>
                        <th>CONTRATO</th><td th:text="${contrato.refContrato}"></td>
                        <th>INICIO</th><td th:text="${#dates.format (contrato.fechaContrato, 'dd/MM/yyyy')}"></td>
                    </tr>
                </TABLE>
                <TABLE class="table  table-striped table-sm table-hover border">
                    <tr>
                        <th>Datos del Contrato</th></tr>
                    <tr>
                        <th>Páginas Incluidas  </th> <td th:text="${contrato.cupoPaginas}"></td>
                        <th>Costo x Página $</th><td th:text="${contrato.costoPagina}"></td>
                        <th>Costo Pág. Adicional $</th><td th:text="${contrato.costoPaginaAdicional}"></td>
                    </tr>
                    <tr><th>Scan Incluidos</th>
                        <td th:text="${contrato.cupoScan}"></td>
                        <th>Costo Scan Adicional $</th>
                        <td th:text="${contrato.costoScanAdicional}"></td>
                        <th>Cargo Básico $</th>
                        <td th:text="${contrato.cargoBasico}"></td>
                    </tr>
                </TABLE>
            </div>

        <div >

                <form action="#" th:action="@{/guardarEvento}" th:object="${newEvento}"  method="POST" >
                    <input type="hidden" id="equipo" name="equipo"  th:value="${ultimoEvento.equipo.id}" >

                    <TABLE class="table table-striped table-sm table-hover border">
                        <tr><th>Fecha Inicial </th>
                            <td th:text="${#dates.format (ultimoEvento.fechaEvento, 'dd/MM/yyyy')}"></td>
                            <th>Fecha Final </th>
                            <td> <input type="date" th:field="*{fechaEvento}" placeholder="Fecha dd/MM/yyyy" >  </td></tr>
                        <tr><th>Paginas Anterior</th>
                            <td th:text="${ultimoEvento.contadorTotal}" ></td>
                            <th>Paginas Actual</th>
                            <td> <input type="text" th:field="*{contadorTotal}" placeholder="Contador" ></td></tr>
                        <tr><th>Scanner Anterior</th>
                            <td th:text="${ultimoEvento.contadorScan}" ></td><th>Scanner Actual</th>
                            <td> <input type="text" th:field="*{contadorScan}" placeholder="Scan" ></td>

                        </tr>
                        <tr><th>Nota</th>
                            <td> <input type="text" th:field="*{detalle}" placeholder="Nota" ></td>
                            <td><input type="checkbox" name="mycheckbox" th:field="*{chargeScan}" th:checked="${flag} ? 'checked'"> Facturar Scan</td>
                        </tr>
                    </TABLE>
                    <input type="button" value="Validar" th:onclick="totalPaginas();">
                    <button type="submit">Guardar Evento</button>
                </form>
        </div>


    </div>
</div>

 <!--OTRO SCRIPTS PARA PAGINAS-->
<th:block layout:fragment="page-scripts">
    <script type="text/javascript">
function totalPaginas()
{
    //tomamos valores de contadores del html, el actual por etiqueta y el inicial por tagname
    var contFinal=parseInt(document.getElementById('contadorTotal').value);
    let obtenerDato = document.getElementsByTagName("td");
    var contInicio=parseInt(obtenerDato[14].innerHTML );
    var paginas=contFinal-contInicio;
    console.log(contInicio);
    //calculamos valores de scanner
    var contFinalScan=parseInt(document.getElementById('contadorScan').value);
    let obtenerDatoScan = document.getElementsByTagName("td");
    var contInicioScan=parseInt(obtenerDato[16].innerHTML );
    console.log(contInicioScan);
    var scan =  contFinalScan-contInicioScan;

    //tomamos las fechas anterior(por etiqueta) y el actual por tagname
    var date =(obtenerDato[12].innerHTML);
    console.log(date);
    var date_2 = new Date(document.getElementById('fechaEvento').value);
    console.log(date_2);
    //Convertimos dd/mm/yyyy a formato string largo
    var dateString = date;
    var dateParts = dateString.split("/");
    // month is 0-based, that's why we need dataParts[1] - 1
    var date_1 = new Date(+dateParts[2], dateParts[1] - 1, +dateParts[0]);
    console.log(date_1);
    //conveetimos a milisegundos para poder restar las fechas
    var day_as_milliseconds = 86400000;
    var diff_in_millisenconds = date_2 - date_1;
    var diff_in_days = Math.ceil(diff_in_millisenconds / day_as_milliseconds);

    console.log( diff_in_days );
    if ((scan < 0) || (diff_in_days <0) || (paginas<0)) {
         alert ("Hay un resultado en valor Negativo, por favor revise los datos introducidos");
    }
    alert ("El numero de Páginas es: "+paginas+"\n"+ "Scan : "+scan+ "\n"+ "Dias : "+diff_in_days );

}
</script>
</th:block>
</body>

</html>
